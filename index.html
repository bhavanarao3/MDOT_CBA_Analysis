<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Pipe Analysis: Cost-Benefit WorkBook</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        h1, h2, h3 {
            color: #0056b3;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #e9ecef;
            color: #333;
        }
        input[type="number"], input[type="text"], select {
            width: calc(100% - 2px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #fff;
        }
        input[type="checkbox"] {
            transform: scale(1.2);
            margin-left: 5px;
        }
        .instructions {
            background-color: #e6f7ff;
            border-left: 5px solid #007bff;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 4px;
        }
        .section-header {
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-header button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .section-header button:hover {
            background-color: #0056b3;
        }
        .summary-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .summary-box h3 {
            margin-top: 0;
            color: #007bff;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }
        .summary-item:last-child {
            border-bottom: none;
        }
        .npv-bcr-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .case-summary {
            background-color: #e0f2f7;
            border: 1px solid #b3e0ed;
            padding: 15px;
            border-radius: 5px;
        }
        .case-summary h4 {
            margin-top: 0;
            color: #006080;
        }
        .positive {
            color: green;
            font-weight: bold;
        }
        .negative {
            color: red;
            font-weight: bold;
        }
        /* Collapsible Cost Table Styles */
        .cost-group-header {
            cursor: pointer;
            background-color: #f0f8ff; /* Light blue for headers */
            font-weight: bold;
        }
        .cost-group-header .toggle-icon {
            display: inline-block;
            width: 1em;
            text-align: center;
            margin-right: 5px;
            transition: transform 0.2s;
        }
        .cost-group-header.expanded .toggle-icon {
            transform: rotate(90deg);
        }
        .cost-detail-row {
            display: none; /* Hidden by default */
        }
        .cost-detail-row td:first-child {
            padding-left: 30px; /* Indent detail rows */
        }
        .cost-detail-row input, .cost-detail-row select {
            background-color: #fcfcfc;
        }

        /* Dynamic Input Controls */
        .dynamic-inputs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        .dynamic-inputs div {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .dynamic-inputs label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        .dynamic-inputs span.calculated-value {
            font-weight: bold;
            color: #007bff;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #eaf6ff;
            text-align: center;
        }

        /* Chart Styles */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px auto;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .chart-container canvas {
            max-height: 100%;
            width: 100% !important;
            height: 100% !important;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        @media (max-width: 900px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 350px;
            }
        }
        .sensitivity-control {
            margin-top: 30px;
            padding: 20px;
            background-color: #e6ffe6;
            border: 1px solid #c8e6c9;
            border-radius: 5px;
            text-align: center;
        }
        .sensitivity-control label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .sensitivity-control input[type="range"] {
            width: 80%;
            margin: 0 auto;
        }
        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        .add-row-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .add-row-btn:hover {
            background-color: #218838;
        }
        .controls-row {
            text-align: right;
            margin-bottom: 15px;
        }
        .controls-row button {
            margin-left: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Video Pipe Analysis: Cost-Benefit WorkBook</h1>

        <div class="instructions">
            <h3>üìù USABILITY INSTRUCTIONS:</h3>
            <ul>
                <li><strong>Step 1:</strong> Adjust the Discount Rate and Lifetime below.</li>
                <li><strong>Step 2:</strong> Expand cost sections by clicking the '+' icon and enter Capital, O&M, and R&R costs in the ‚ÄòCost Inputs‚Äô table. 'Base Case' covers retrofitting existing robots (CUES & Envirosight sensors) and 'Build Case' covers new full system replacements (CUES Ultra Short, Redzone, Rausch).</li>
                <li><strong>Step 3:</strong> Select applicable benefits and enter justifications in ‚ÄòBenefit Selection & Quantification‚Äô.</li>
                <li><strong>Step 4:</strong> Review the ‚ÄòNPV & BCR Calculator‚Äô section to see results.</li>
                <li><strong>Step 5:</strong> Use the ‚ÄòScenario Dashboard‚Äô section for visual insights and simplified sensitivity analysis.</li>
            </ul>
        </div>

        <div class="controls-row">
            <button id="resetButton" class="section-header-btn">Reset to Defaults</button>
        </div>

        <h2 class="section-header">
            <span>Cost Inputs</span>
            <button id="addCostRowBtn" class="add-row-btn">Add New Cost Item Group</button>
        </h2>

        <div class="dynamic-inputs">
            <div>
                <label for="discountRate">Discount Rate (%)</label>
                <input type="number" id="discountRate" value="7" min="0" step="0.1">
            </div>
            <div>
                <label for="lifetime">Lifetime (Years)</label>
                <input type="number" id="lifetime" value="10" min="1" step="1">
            </div>
            <div>
                <label>Calculated PV Factor</label>
                <span id="pvFactorDisplay" class="calculated-value"></span>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Case Type</th>
                    <th>System/Sensor Name</th>
                    <th>Cost Type</th>
                    <th>Annual Cost (USD)</th>
                    <th>PV Factor</th>
                    <th>Total Discounted Cost (USD)</th>
                    <th>Notes</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="costInputsTableBody">
                <!-- Cost rows will be dynamically inserted here -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="6" style="text-align: right; font-weight: bold;">Total Discounted Costs (Base Case):</td>
                    <td id="totalDiscountedCostBase" style="font-weight: bold;"></td>
                    <td></td> <!-- For the Action column -->
                </tr>
                <tr>
                    <td colspan="6" style="text-align: right; font-weight: bold;">Total Discounted Costs (Build Case):</td>
                    <td id="totalDiscountedCostBuild" style="font-weight: bold;"></td>
                    <td></td> <!-- For the Action column -->
                </tr>
            </tfoot>
        </table>

        <h2 class="section-header">
            <span>Benefit Selection & Quantification</span>
            <button id="addBenefitRowBtn" class="add-row-btn">Add Benefit Item</button>
        </h2>

        <table>
            <thead>
                <tr>
                    <th>Benefit Type</th>
                    <th>Applicable to</th>
                    <th>Selected?</th>
                    <th>Annual Value (USD)</th>
                    <th>PV Factor</th>
                    <th>Total Discounted Benefit (USD)</th>
                    <th>Justification / Formula</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="benefitInputsTableBody">
                <!-- Benefit rows will be dynamically inserted here -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="7" style="text-align: right; font-weight: bold;">Total Applied Benefits (Base Case):</td>
                    <td id="totalAppliedBenefitBase" style="font-weight: bold;"></td>
                </tr>
                <tr>
                    <td colspan="7" style="text-align: right; font-weight: bold;">Total Applied Benefits (Build Case):</td>
                    <td id="totalAppliedBenefitBuild" style="font-weight: bold;"></td>
                </tr>
            </tfoot>
        </table>

        <h2 class="section-header">NPV & BCR Calculator</h2>
        <div class="npv-bcr-grid">
            <div class="case-summary">
                <h4>Base Case Summary</h4>
                <div class="summary-item"><span>Total Discounted Costs:</span> <span id="baseCostSummary"></span></div>
                <div class="summary-item"><span>Total Discounted Benefits:</span> <span id="baseBenefitSummary"></span></div>
                <div class="summary-item"><span>Net Present Value (NPV):</span> <span id="baseNPV"></span></div>
                <div class="summary-item"><span>Benefit-Cost Ratio (BCR):</span> <span id="baseBCR"></span></div>
            </div>
            <div class="case-summary">
                <h4>Build Case Summary</h4>
                <div class="summary-item"><span>Total Discounted Costs:</span> <span id="buildCostSummary"></span></div>
                <div class="summary-item"><span>Total Discounted Benefits:</span> <span id="buildBenefitSummary"></span></div>
                <div class="summary-item"><span>Net Present Value (NPV):</span> <span id="buildNPV"></span></div>
                <div class="summary-item"><span>Benefit-Cost Ratio (BCR):</span> <span id="buildBCR"></span></div>
            </div>
        </div>

        <h2 class="section-header">Scenario Dashboard</h2>
        <div class="charts-grid">
            <div class="chart-container">
                <h3>Lifecycle Cost Composition</h3>
                <canvas id="costCompositionChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>NPV & BCR Comparison</h3>
                <canvas id="npvBcrChart"></canvas>
            </div>
        </div>

        <div class="sensitivity-control">
            <label for="sensitivitySlider">Sensitivity Analysis: Adjust all Costs/Benefits by <span id="sensitivityValue">0</span>%</label>
            <input type="range" id="sensitivitySlider" min="-20" max="20" value="0" step="1">
            <div class="chart-container">
                <h3>Adjusted NPV Comparison</h3>
                <canvas id="adjustedNpvChart"></canvas>
            </div>
        </div>

    </div> <!-- End of container -->

    <script>
        // --- Default Data Storage ---
        const defaultCosts = [
            { caseType: 'Base Case', type: 'group', name: 'CUES Robot Retrofits (Summary)', id: 'cues-base', notes: 'Combined costs for CUES sensor retrofits', expanded: false },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'HD PTZ Camera', costType: 'Capital', annualCost: 12500, notes: 'Retrofit HD PTZ Camera for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'HD PTZ Camera O&M', costType: 'O&M', annualCost: 1250, notes: 'Annual O&M for new HD PTZ Camera' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'HD PTZ Camera R&R', costType: 'R&R', annualCost: 950, notes: 'Annualized R&R for HD PTZ Camera' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'OZIII Camera', costType: 'Capital', annualCost: 9500, notes: 'Retrofit OZIII Camera for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'OZIII Camera O&M', costType: 'O&M', annualCost: 900, notes: 'Annual O&M for OZIII Camera' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'OZIII Camera R&R', costType: 'R&R', annualCost: 700, notes: 'Annualized R&R for OZIII Camera' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'Wide Angle Camera', costType: 'Capital', annualCost: 4250, notes: 'Retrofit Wide Angle Camera for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'CUES Fish-eye', costType: 'Capital', annualCost: 7000, notes: 'Retrofit CUES Fish-eye Camera' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'Thermal Imaging', costType: 'Capital', annualCost: 13500, notes: 'Retrofit Thermal Imaging for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'FLIR IR Add-on', costType: 'Capital', annualCost: 10000, notes: 'Retrofit FLIR IR Add-on for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'Laser Profiler', costType: 'Capital', annualCost: 12500, notes: 'Retrofit Laser Profiler for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'CUES Laser Profiler', costType: 'Capital', annualCost: 13500, notes: 'Retrofit CUES Laser Profiler' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'Sensor Control Software (CUES)', costType: 'Capital', annualCost: 6500, notes: 'Retrofit Sensor Control Software for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'GraniteNet Add-ons (CUES)', costType: 'Capital', annualCost: 4750, notes: 'Retrofit GraniteNet Add-ons for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'IR Ring Light (CUES)', costType: 'Capital', annualCost: 2750, notes: 'Retrofit IR Ring Light for CUES' },
            { caseType: 'Base Case', type: 'detail', groupId: 'cues-base', systemName: 'CUES Infrared Ring Light', costType: 'Capital', annualCost: 3300, notes: 'Retrofit CUES Infrared Ring Light' },

            { caseType: 'Base Case', type: 'group', name: 'Envirosight Rover Retrofits (Summary)', id: 'envirosight-base', notes: 'Combined costs for Envirosight sensor retrofits', expanded: false },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'HD PTZ Camera (Envirosight)', costType: 'Capital', annualCost: 14000, notes: 'Retrofit HD PTZ Camera for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Envirosight AXIAL Camera', costType: 'Capital', annualCost: 7000, notes: 'Retrofit Envirosight AXIAL Camera' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Rear Camera (Envirosight)', costType: 'Capital', annualCost: 5250, notes: 'Retrofit Rear Camera for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Laser Profiler (Envirosight)', costType: 'Capital', annualCost: 14500, notes: 'Retrofit Laser Profiler for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Envirosight Laser Profiler', costType: 'Capital', annualCost: 15250, notes: 'Retrofit Envirosight Laser Profiler' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'LiDAR Module (Envirosight)', costType: 'Capital', annualCost: 27500, notes: 'Retrofit LiDAR Module for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Velodyne Puck/Ouster OS0', costType: 'Capital', annualCost: 12000, notes: 'Retrofit Velodyne Puck/Ouster OS0 for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Inclinometer (Envirosight)', costType: 'Capital', annualCost: 1650, notes: 'Retrofit Inclinometer for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Thermal Imaging (Envirosight)', costType: 'Capital', annualCost: 14500, notes: 'Retrofit Thermal Imaging for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'FLIR IR Add-on (Envirosight)', costType: 'Capital', annualCost: 10000, notes: 'Retrofit FLIR IR Add-on for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'Sensor Control Software (Envirosight)', costType: 'Capital', annualCost: 7250, notes: 'Retrofit Sensor Control Software for Envirosight' },
            { caseType: 'Base Case', type: 'detail', groupId: 'envirosight-base', systemName: 'WinCan VX + GraniteNet (Envirosight)', costType: 'Capital', annualCost: 8000, notes: 'Retrofit WinCan VX + GraniteNet for Envirosight' },

            { caseType: 'Build Case', type: 'group', name: 'CUES Ultra Short III (Summary)', id: 'cues-ultrashort-build', notes: 'Full system replacement: CUES Ultra Short III', expanded: false },
            { caseType: 'Build Case', type: 'detail', groupId: 'cues-ultrashort-build', systemName: 'CUES Ultra Short III System Capital', costType: 'Capital', annualCost: 115000, notes: 'Initial purchase' },
            { caseType: 'Build Case', type: 'detail', groupId: 'cues-ultrashort-build', systemName: 'CUES Ultra Short III O&M', costType: 'O&M', annualCost: 11500, notes: 'Annual O&M for new CUES Ultra Short III' },
            { caseType: 'Build Case', type: 'detail', groupId: 'cues-ultrashort-build', systemName: 'CUES Ultra Short III R&R', costType: 'R&R', annualCost: 9000, notes: 'Annualized R&R for CUES Ultra Short III' },

            { caseType: 'Build Case', type: 'group', name: 'Redzone System (Summary)', id: 'redzone-build', notes: 'Full system replacement: Redzone', expanded: false },
            { caseType: 'Build Case', type: 'detail', groupId: 'redzone-build', systemName: 'Redzone System Capital', costType: 'Capital', annualCost: 130000, notes: 'Initial purchase' },
            { caseType: 'Build Case', type: 'detail', groupId: 'redzone-build', systemName: 'Redzone System O&M', costType: 'O&M', annualCost: 13000, notes: 'Annual O&M for Redzone System' },
            { caseType: 'Build Case', type: 'detail', groupId: 'redzone-build', systemName: 'Redzone System R&R', costType: 'R&R', annualCost: 10000, notes: 'Annualized R&R for Redzone System' },

            { caseType: 'Build Case', type: 'group', name: 'Rausch System (Summary)', id: 'rausch-build', notes: 'Full system replacement: Rausch', expanded: false },
            { caseType: 'Build Case', type: 'detail', groupId: 'rausch-build', systemName: 'Rausch System Capital', costType: 'Capital', annualCost: 120000, notes: 'Initial purchase' },
            { caseType: 'Build Case', type: 'detail', groupId: 'rausch-build', systemName: 'Rausch System O&M', costType: 'O&M', annualCost: 12000, notes: 'Annual O&M for Rausch System' },
            { caseType: 'Build Case', type: 'detail', groupId: 'rausch-build', systemName: 'Rausch System R&R', costType: 'R&R', annualCost: 9500, notes: 'Annualized R&R for Rausch System' },
        ];

        const defaultBenefits = [
            {
                benefitType: 'Reduced Service Interruption',
                quantification: 'Less downtime during inspections means more operational hours. Value = (Hours saved per year * Cost of downtime per hour).',
                applicableTo: ['Base Case', 'Build Case'],
                selected: true,
                annualValue: 5000,
                justification: 'Estimated 25 hours saved per year @ $200/hr.'
            },
            {
                benefitType: 'Improved Worker Safety',
                quantification: 'Fewer manual entries into confined spaces. Value = (Reduced injury costs + Reduced insurance premiums + Increased productivity from fewer incidents).',
                applicableTo: ['Build Case'],
                selected: true,
                annualValue: 7500,
                justification: 'Avoided 1 incident cost and reduced safety training needs.'
            },
            {
                benefitType: 'Faster Inspection Rates',
                quantification: 'Complete more inspections in less time. Value = (Additional inspections per year * Revenue/Value per inspection).',
                applicableTo: ['Build Case'],
                selected: true,
                annualValue: 10000,
                justification: 'Ability to complete 50 more inspections annually @ $200/inspection.'
            },
            {
                benefitType: 'Higher Inspection Accuracy',
                quantification: 'Better identification of defects reduces rework/future repair costs. Value = (Cost of avoided rework/repairs due to missed defects).',
                applicableTo: ['Build Case'],
                selected: true,
                annualValue: 12000,
                justification: 'Estimated 2 major avoided repairs due to early detection.'
            },
            {
                benefitType: 'Extended Asset Lifespan',
                quantification: 'Better monitoring leads to timely maintenance, extending pipe life. Value = (Annualized replacement cost of asset / % extension).',
                applicableTo: ['Build Case'],
                selected: false, // Default to not selected
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Reduced Environmental Impact',
                quantification: 'Fewer leaks, overflows. Value = (Avoided environmental fines + Cleanup costs).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Improved Data Quality',
                quantification: 'Better data for predictive maintenance and planning. Value = (Efficiency gains from better planning + Avoided costs from reactive repairs).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Reduced Labor Costs',
                quantification: 'Fewer personnel required per inspection. Value = (FTEs reduced * Average fully loaded salary).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Enhanced Public Perception',
                quantification: 'Proactive maintenance avoids service disruptions. Value = (Avoided PR costs + Increased public trust).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Compliance with Regulations',
                quantification: 'Avoiding penalties from non-compliance. Value = (Avoided fines).',
                applicableTo: ['Base Case', 'Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Increased Efficiency in Reporting',
                quantification: 'Automated reporting saves staff time. Value = (Hours saved per year * Labor cost per hour).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Better Resource Planning',
                quantification: 'Improved data leads to optimized crew and equipment scheduling. Value = (Operational cost savings).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Energy Savings (Robotics)',
                quantification: 'More efficient robotics consume less energy than older models. Value = (kWh saved per year * Cost per kWh).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Reduced Training Time',
                quantification: 'Easier-to-use systems require less training. Value = (Hours saved * Training cost per hour/person).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            },
            {
                benefitType: 'Scalability for Future Growth',
                quantification: 'Ability to handle more inspections without proportional cost increase. Value = (Cost of avoiding future capital investments).',
                applicableTo: ['Build Case'],
                selected: false,
                annualValue: 0,
                justification: ''
            }
        ];

        let currentCosts = JSON.parse(JSON.stringify(defaultCosts)); // Deep copy
        let currentBenefits = JSON.parse(JSON.stringify(defaultBenefits)); // Deep copy

        let costCompositionChart;
        let npvBcrChart;
        let adjustedNpvChart;

        // --- Core Calculation Functions ---
        function calculatePVFactor(discountRate, lifetime) {
            const r = discountRate / 100;
            if (r === 0) {
                return lifetime;
            }
            return (1 - Math.pow(1 + r, -lifetime)) / r;
        }

        function calculateDiscountedValue(annualCost, costType, pvFactor) {
            if (costType === 'Capital') {
                return annualCost;
            } else if (costType === 'O&M' || costType === 'R&R') {
                return annualCost * pvFactor;
            }
            return 0;
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
        }

        // --- Render Functions ---
        function renderCostTable() {
            const tableBody = document.getElementById('costInputsTableBody');
            tableBody.innerHTML = ''; // Clear existing rows

            const discountRate = parseFloat(document.getElementById('discountRate').value);
            const lifetime = parseInt(document.getElementById('lifetime').value);
            const pvFactor = calculatePVFactor(discountRate, lifetime);
            document.getElementById('pvFactorDisplay').textContent = pvFactor.toFixed(4);

            let baseTotalCost = 0;
            let buildTotalCost = 0;

            currentCosts.forEach((item, index) => {
                let rowHtml = '';
                if (item.type === 'group') {
                    rowHtml = `
                        <tr class="cost-group-header ${item.expanded ? 'expanded' : ''}" data-case-type="${item.caseType}" data-group-id="${item.id}">
                            <td><span class="toggle-icon">${item.expanded ? '&#9660;' : '&#9658;'}</span> ${item.caseType}</td>
                            <td>${item.name}</td>
                            <td>Summary</td>
                            <td></td>
                            <td class="pvFactor"></td>
                            <td class="totalDiscountedCost"></td>
                            <td><input type="text" class="notes" value="${item.notes}" readonly></td>
                            <td><button class="delete-btn" data-row-index="${index}">Delete Group</button></td>
                        </tr>
                    `;
                } else if (item.type === 'detail') {
                    const discountedCost = calculateDiscountedValue(item.annualCost, item.costType, pvFactor);
                    rowHtml = `
                        <tr class="cost-detail-row" data-group-id="${item.groupId}" data-row-index="${index}" ${currentCosts.find(g => g.id === item.groupId && g.expanded) ? '' : 'style="display:none;"'}>
                            <td></td>
                            <td><input type="text" class="systemName" value="${item.systemName}"></td>
                            <td>
                                <select class="costType">
                                    <option value="Capital" ${item.costType === 'Capital' ? 'selected' : ''}>Capital</option>
                                    <option value="O&M" ${item.costType === 'O&M' ? 'selected' : ''}>O&M</option>
                                    <option value="R&R" ${item.costType === 'R&R' ? 'selected' : ''}>R&R</option>
                                </select>
                            </td>
                            <td><input type="number" class="annualCost" value="${item.annualCost}" min="0"></td>
                            <td class="pvFactor">${item.costType === 'Capital' ? 'N/A' : pvFactor.toFixed(4)}</td>
                            <td class="totalDiscountedCost-item">${formatCurrency(discountedCost)}</td>
                            <td><input type="text" class="notes" value="${item.notes || ''}"></td>
                            <td><button class="delete-btn" data-row-index="${index}">Delete</button></td>
                        </tr>
                    `;

                    if (item.caseType === 'Base Case') {
                        baseTotalCost += discountedCost;
                    } else if (item.caseType === 'Build Case') {
                        buildTotalCost += discountedCost;
                    }
                }
                tableBody.insertAdjacentHTML('beforeend', rowHtml);
            });

            // Update summary totals for groups
            currentCosts.filter(item => item.type === 'group').forEach(group => {
                const groupCost = currentCosts.filter(detail => detail.type === 'detail' && detail.groupId === group.id)
                                            .reduce((sum, detail) => sum + calculateDiscountedValue(detail.annualCost, detail.costType, pvFactor), 0);
                const groupRow = tableBody.querySelector(`tr.cost-group-header[data-group-id="${group.id}"] .totalDiscountedCost`);
                if (groupRow) {
                    groupRow.textContent = formatCurrency(groupCost);
                }
            });


            document.getElementById('totalDiscountedCostBase').textContent = formatCurrency(baseTotalCost);
            document.getElementById('totalDiscountedCostBuild').textContent = formatCurrency(buildTotalCost);

            // Re-attach event listeners after rendering
            attachCostTableListeners();
            updateCharts(); // Update charts after cost changes
        }

        function renderBenefitTable() {
            const tableBody = document.getElementById('benefitInputsTableBody');
            tableBody.innerHTML = ''; // Clear existing rows

            const discountRate = parseFloat(document.getElementById('discountRate').value);
            const lifetime = parseInt(document.getElementById('lifetime').value);
            const pvFactor = calculatePVFactor(discountRate, lifetime);

            let baseTotalBenefit = 0;
            let buildTotalBenefit = 0;

            currentBenefits.forEach((item, index) => {
                const discountedBenefit = calculateDiscountedValue(item.annualValue, 'O&M', pvFactor); // Benefits are like O&M
                const applicableBaseChecked = item.applicableTo.includes('Base Case') ? 'checked' : '';
                const applicableBuildChecked = item.applicableTo.includes('Build Case') ? 'checked' : '';

                let rowHtml = `
                    <tr data-row-index="${index}">
                        <td><input type="text" class="benefitType" value="${item.benefitType}"></td>
                        <td>
                            <label><input type="checkbox" class="applicableToBase" ${applicableBaseChecked}> Base</label><br>
                            <label><input type="checkbox" class="applicableToBuild" ${applicableBuildChecked}> Build</label>
                        </td>
                        <td><input type="checkbox" class="benefitSelected" ${item.selected ? 'checked' : ''}></td>
                        <td><input type="number" class="annualValue" value="${item.annualValue}" min="0"></td>
                        <td class="pvFactor">${pvFactor.toFixed(4)}</td>
                        <td class="totalDiscountedBenefit-item">${formatCurrency(discountedBenefit)}</td>
                        <td><input type="text" class="justification" value="${item.justification || ''}"></td>
                        <td><button class="delete-btn" data-row-index="${index}">Delete</button></td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', rowHtml);

                if (item.selected) {
                    if (item.applicableTo.includes('Base Case')) {
                        baseTotalBenefit += discountedBenefit;
                    }
                    if (item.applicableTo.includes('Build Case')) {
                        buildTotalBenefit += discountedBenefit;
                    }
                }
            });

            document.getElementById('totalAppliedBenefitBase').textContent = formatCurrency(baseTotalBenefit);
            document.getElementById('totalAppliedBenefitBuild').textContent = formatCurrency(buildTotalBenefit);

            // Re-attach event listeners after rendering
            attachBenefitTableListeners();
            updateCharts(); // Update charts after benefit changes
        }

        // --- Add/Delete Row Functions ---
        function addCostRow() {
            // Prompt user for caseType
            let caseTypeChoice = prompt("Add new cost item group for: (Type 'Base Case' or 'Build Case')");
            if (!caseTypeChoice) {
                return; // User cancelled
            }
            caseTypeChoice = caseTypeChoice.trim();
            if (caseTypeChoice !== 'Base Case' && caseTypeChoice !== 'Build Case') {
                alert("Invalid input. Please type 'Base Case' or 'Build Case'.");
                return;
            }

            // Generate a unique ID for the new collapsible group
            const newGroupId = `user-added-group-${Date.now()}`; // Unique ID based on timestamp
            const groupName = `User Added Item (${caseTypeChoice})`;

            // Add the new group header
            currentCosts.push({
                caseType: caseTypeChoice,
                type: 'group',
                name: groupName,
                id: newGroupId,
                notes: 'User added custom cost group',
                expanded: true // New groups should be expanded by default
            });

            // Add the three default detail rows inside this new group
            currentCosts.push({
                caseType: caseTypeChoice,
                type: 'detail',
                groupId: newGroupId,
                systemName: 'Capital Cost',
                costType: 'Capital',
                annualCost: 0,
                notes: 'Initial capital investment'
            });
            currentCosts.push({
                caseType: caseTypeChoice,
                type: 'detail',
                groupId: newGroupId,
                systemName: 'O&M Cost',
                costType: 'O&M',
                annualCost: 0,
                notes: 'Annual operating & maintenance'
            });
            currentCosts.push({
                caseType: caseTypeChoice,
                type: 'detail',
                groupId: newGroupId,
                systemName: 'R&R Cost',
                costType: 'R&R',
                annualCost: 0,
                notes: 'Annualized repair & replacement'
            });

            // Re-render the table to show the new rows
            renderCostTable();
        }

        function deleteCostRow(index) {
            const itemToDelete = currentCosts[index];
            if (itemToDelete.type === 'detail') {
                currentCosts.splice(index, 1);
            } else if (itemToDelete.type === 'group') {
                // If it's a group, confirm deletion of all its details
                if (confirm(`Are you sure you want to delete the group "${itemToDelete.name}" and all its associated detail items?`)) {
                    // Filter out the group itself and all detail items belonging to this group
                    currentCosts = currentCosts.filter(item => item.id !== itemToDelete.id && item.groupId !== itemToDelete.id);
                } else {
                    return; // Stop if user cancels
                }
            }
            renderCostTable();
        }

        function addBenefitRow() {
            currentBenefits.push({
                benefitType: 'New Benefit Item',
                quantification: 'Add quantification method here.',
                applicableTo: ['Build Case'], // Default to build case
                selected: true,
                annualValue: 0,
                justification: ''
            });
            renderBenefitTable();
        }

        function deleteBenefitRow(index) {
            currentBenefits.splice(index, 1);
            renderBenefitTable();
        }

        // --- Event Listeners ---
        function attachCostTableListeners() {
            const tableBody = document.getElementById('costInputsTableBody');

            // Attach listeners to input fields (systemName, annualCost, costType, notes)
            tableBody.querySelectorAll('input, select').forEach(input => {
                input.oninput = (e) => {
                    const row = e.target.closest('.cost-detail-row');
                    if (!row) return;

                    const index = parseInt(row.dataset.rowIndex);
                    const item = currentCosts[index];

                    if (e.target.classList.contains('systemName')) {
                        item.systemName = e.target.value;
                    } else if (e.target.classList.contains('annualCost')) {
                        item.annualCost = parseFloat(e.target.value) || 0;
                    } else if (e.target.classList.contains('costType')) {
                        item.costType = e.target.value;
                    } else if (e.target.classList.contains('notes')) {
                        item.notes = e.target.value;
                    }
                    renderCostTable(); // Re-render to update discounted costs and totals
                };
            });

            // Attach listeners to group headers for expanding/collapsing
            tableBody.querySelectorAll('.cost-group-header').forEach(header => {
                header.onclick = (e) => {
                    // Prevent event from bubbling if a button inside the header was clicked
                    if (e.target.tagName === 'BUTTON') return;

                    const groupId = header.dataset.groupId;
                    const groupItem = currentCosts.find(g => g.type === 'group' && g.id === groupId);
                    if (groupItem) {
                        groupItem.expanded = !groupItem.expanded;
                        // Toggle icon
                        const toggleIcon = header.querySelector('.toggle-icon');
                        if (groupItem.expanded) {
                            toggleIcon.innerHTML = '&#9660;'; // Down arrow
                            header.classList.add('expanded');
                        } else {
                            toggleIcon.innerHTML = '&#9658;'; // Right arrow
                            header.classList.remove('expanded');
                        }
                    }

                    // Toggle visibility of detail rows
                    tableBody.querySelectorAll(`.cost-detail-row[data-group-id="${groupId}"]`).forEach(row => {
                        row.style.display = groupItem.expanded ? 'table-row' : 'none';
                    });
                };
            });

            // Attach listeners to delete buttons
            tableBody.querySelectorAll('.delete-btn').forEach(button => {
                button.onclick = (e) => {
                    const index = parseInt(e.target.dataset.rowIndex);
                    deleteCostRow(index);
                };
            });
        }

        function attachBenefitTableListeners() {
            const tableBody = document.getElementById('benefitInputsTableBody');

            // Attach listeners to input fields
            tableBody.querySelectorAll('input, select').forEach(input => {
                input.oninput = (e) => {
                    const row = e.target.closest('tr');
                    if (!row) return;

                    const index = parseInt(row.dataset.rowIndex);
                    const item = currentBenefits[index];

                    if (e.target.classList.contains('benefitType')) {
                        item.benefitType = e.target.value;
                    } else if (e.target.classList.contains('annualValue')) {
                        item.annualValue = parseFloat(e.target.value) || 0;
                    } else if (e.target.classList.contains('justification')) {
                        item.justification = e.target.value;
                    } else if (e.target.classList.contains('benefitSelected')) {
                        item.selected = e.target.checked;
                    } else if (e.target.classList.contains('applicableToBase')) {
                        if (e.target.checked && !item.applicableTo.includes('Base Case')) {
                            item.applicableTo.push('Base Case');
                        } else if (!e.target.checked) {
                            item.applicableTo = item.applicableTo.filter(caseType => caseType !== 'Base Case');
                        }
                    } else if (e.target.classList.contains('applicableToBuild')) {
                        if (e.target.checked && !item.applicableTo.includes('Build Case')) {
                            item.applicableTo.push('Build Case');
                        } else if (!e.target.checked) {
                            item.applicableTo = item.applicableTo.filter(caseType => caseType !== 'Build Case');
                        }
                    }
                    renderBenefitTable(); // Re-render to update discounted benefits and totals
                };
            });

            // Attach listeners to delete buttons
            tableBody.querySelectorAll('.delete-btn').forEach(button => {
                button.onclick = (e) => {
                    const index = parseInt(e.target.dataset.rowIndex);
                    deleteBenefitRow(index);
                };
            });
        }


        // --- Charting Functions ---
        function updateCharts(sensitivityAdjustment = 0) {
            const discountRate = parseFloat(document.getElementById('discountRate').value);
            const lifetime = parseInt(document.getElementById('lifetime').value);
            const pvFactor = calculatePVFactor(discountRate, lifetime);

            let baseCostTotal = 0;
            let buildCostTotal = 0;
            let baseCapitalCost = 0;
            let baseOMCost = 0;
            let baseRRRcost = 0;
            let buildCapitalCost = 0;
            let buildOMCost = 0;
            let buildRRRcost = 0;

            currentCosts.filter(item => item.type === 'detail').forEach(item => {
                const adjustedCost = (item.annualCost * (1 + sensitivityAdjustment / 100));
                const discountedCost = calculateDiscountedValue(adjustedCost, item.costType, pvFactor);

                if (item.caseType === 'Base Case') {
                    baseCostTotal += discountedCost;
                    if (item.costType === 'Capital') baseCapitalCost += discountedCost;
                    else if (item.costType === 'O&M') baseOMCost += discountedCost;
                    else if (item.costType === 'R&R') baseRRRcost += discountedCost;
                } else if (item.caseType === 'Build Case') {
                    buildCostTotal += discountedCost;
                    if (item.costType === 'Capital') buildCapitalCost += discountedCost;
                    else if (item.costType === 'O&M') buildOMCost += discountedCost;
                    else if (item.costType === 'R&R') buildRRRcost += discountedCost;
                }
            });

            let baseBenefitTotal = 0;
            let buildBenefitTotal = 0;

            currentBenefits.forEach(item => {
                if (item.selected) {
                    const adjustedBenefit = (item.annualValue * (1 + sensitivityAdjustment / 100));
                    const discountedBenefit = calculateDiscountedValue(adjustedBenefit, 'O&M', pvFactor); // Benefits are treated like O&M for PV factor

                    if (item.applicableTo.includes('Base Case')) {
                        baseBenefitTotal += discountedBenefit;
                    }
                    if (item.applicableTo.includes('Build Case')) {
                        buildBenefitTotal += discountedBenefit;
                    }
                }
            });

            const baseNPV = baseBenefitTotal - baseCostTotal;
            const buildNPV = buildBenefitTotal - buildCostTotal;

            const baseBCR = baseCostTotal > 0 ? baseBenefitTotal / baseCostTotal : (baseBenefitTotal > 0 ? Infinity : 0);
            const buildBCR = buildCostTotal > 0 ? buildBenefitTotal / buildCostTotal : (buildBenefitTotal > 0 ? Infinity : 0);

            // Update summary boxes
            document.getElementById('baseCostSummary').textContent = formatCurrency(baseCostTotal);
            document.getElementById('baseBenefitSummary').textContent = formatCurrency(baseBenefitTotal);
            document.getElementById('baseNPV').textContent = formatCurrency(baseNPV);
            document.getElementById('baseNPV').className = baseNPV >= 0 ? 'positive' : 'negative';
            document.getElementById('baseBCR').textContent = isFinite(baseBCR) ? baseBCR.toFixed(2) : (baseBCR === Infinity ? 'Infinite' : 'N/A');
            document.getElementById('baseBCR').className = baseBCR >= 1 ? 'positive' : 'negative';

            document.getElementById('buildCostSummary').textContent = formatCurrency(buildCostTotal);
            document.getElementById('buildBenefitSummary').textContent = formatCurrency(buildBenefitTotal);
            document.getElementById('buildNPV').textContent = formatCurrency(buildNPV);
            document.getElementById('buildNPV').className = buildNPV >= 0 ? 'positive' : 'negative';
            document.getElementById('buildBCR').textContent = isFinite(buildBCR) ? buildBCR.toFixed(2) : (buildBCR === Infinity ? 'Infinite' : 'N/A');
            document.getElementById('buildBCR').className = buildBCR >= 1 ? 'positive' : 'negative';

            // --- Update Charts ---
            // Chart 1: Lifecycle Cost Composition
            if (costCompositionChart) costCompositionChart.destroy();
            const ctx1 = document.getElementById('costCompositionChart').getContext('2d');
            costCompositionChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Base Case', 'Build Case'],
                    datasets: [
                        {
                            label: 'Capital Costs',
                            data: [baseCapitalCost, buildCapitalCost],
                            backgroundColor: '#007bff',
                            stack: 'costs'
                        },
                        {
                            label: 'O&M Costs',
                            data: [baseOMCost, buildOMCost],
                            backgroundColor: '#28a745',
                            stack: 'costs'
                        },
                        {
                            label: 'R&R Costs',
                            data: [baseRRRcost, buildRRRcost],
                            backgroundColor: '#ffc107',
                            stack: 'costs'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: { display: true, text: 'Costs (USD)' },
                            ticks: {
                                callback: function(value, index, values) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // Chart 2: NPV & BCR Comparison
            if (npvBcrChart) npvBcrChart.destroy();
            const ctx2 = document.getElementById('npvBcrChart').getContext('2d');
            npvBcrChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Base Case', 'Build Case'],
                    datasets: [
                        {
                            label: 'Net Present Value (NPV)',
                            data: [baseNPV, buildNPV],
                            backgroundColor: ['#007bff', '#28a745'],
                            yAxisID: 'y'
                        },
                        {
                            label: 'Benefit-Cost Ratio (BCR)',
                            data: [baseBCR, buildBCR],
                            type: 'line',
                            borderColor: '#ffc107',
                            backgroundColor: '#ffc107',
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'NPV (USD)' },
                            ticks: {
                                callback: function(value, index, values) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'BCR' },
                            min: 0
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.dataset.label.includes('NPV')) {
                                        label += formatCurrency(context.parsed.y);
                                    } else {
                                        label += context.parsed.y.toFixed(2);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // Chart 3: Adjusted NPV Comparison (Sensitivity)
            if (adjustedNpvChart) adjustedNpvChart.destroy();
            const ctx3 = document.getElementById('adjustedNpvChart').getContext('2d');
            adjustedNpvChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: ['Base Case', 'Build Case'],
                    datasets: [
                        {
                            label: 'Adjusted Net Present Value (NPV)',
                            data: [baseNPV, buildNPV],
                            backgroundColor: [
                                baseNPV >= 0 ? '#007bff' : '#dc3545', // Blue for positive, Red for negative
                                buildNPV >= 0 ? '#28a745' : '#dc3545'
                            ]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false, // Allow negative values for NPV
                            title: { display: true, text: 'Adjusted NPV (USD)' },
                            ticks: {
                                callback: function(value, index, values) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Reset Function ---
        function resetToDefaults() {
            if (confirm("Are you sure you want to reset all data to default values? This cannot be undone.")) {
                currentCosts = JSON.parse(JSON.stringify(defaultCosts)); // Reset to deep copy of defaults
                currentBenefits = JSON.parse(JSON.stringify(defaultBenefits)); // Reset to deep copy of defaults
                document.getElementById('discountRate').value = 7;
                document.getElementById('lifetime').value = 10;
                document.getElementById('sensitivitySlider').value = 0;
                document.getElementById('sensitivityValue').textContent = 0;
                renderCostTable();
                renderBenefitTable();
                updateCharts(); // Ensure all calculations and charts are updated
            }
        }

        // --- Initial Load & Event Bindings ---
        document.addEventListener('DOMContentLoaded', () => {
            renderCostTable();
            renderBenefitTable();

            // Global inputs
            document.getElementById('discountRate').addEventListener('input', () => {
                renderCostTable();
                renderBenefitTable();
            });
            document.getElementById('lifetime').addEventListener('input', () => {
                renderCostTable();
                renderBenefitTable();
            });

            // Add Row Buttons
            document.getElementById('addCostRowBtn').addEventListener('click', addCostRow); // No arguments needed here
            document.getElementById('addBenefitRowBtn').addEventListener('click', addBenefitRow);

            // Reset Button
            document.getElementById('resetButton').addEventListener('click', resetToDefaults);

            // Sensitivity Slider
            document.getElementById('sensitivitySlider').addEventListener('input', (e) => {
                const sensitivity = parseFloat(e.target.value);
                document.getElementById('sensitivityValue').textContent = sensitivity;
                updateCharts(sensitivity);
            });
        });

    </script>
</body>
</html>
